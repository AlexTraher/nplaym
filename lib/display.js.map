{"version":3,"sources":["../src/display.js"],"names":[],"mappings":"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","file":"display.js","sourcesContent":["import { HEIGHT, WIDTH, LEFTWALL, RIGHTWALL, MIDWIDTH, MIDHEIGHT, FPS, FRAMERATE, DIFFICULTY, STARTTIME, PLAYERLINE } from './constants.js';\nimport { SCORE, setScore, checkIntersects, checkBullet, gameState, player } from './game.js';\nimport { npmOutput } from './io.js';\nimport colors from 'colors';\nimport term from 'node-terminal';\nimport Q from 'q';\n\nfunction paintScreen () {\n\n  for (let line = 0; line < HEIGHT; line++) {\n\n    if (line === HEIGHT - 2) {\n      const out = npmOutput.replace(/\\r?\\n|\\r/g, '');\n      term.write(out);\n      term.left(out.length)\n    }\n\n    if (line === 4) {\n      setScore();\n      term.write(SCORE);\n      const scoreWidth = SCORE.toString().length;\n      term.left(scoreWidth);\n    }\n\n    paintMovers(line)\n\n    term.nl();\n  }\n\n  gameState.filter(item => item.type === 'bullet' || item.type === 'mob')\n    .forEach(item => {\n      item.tick();\n    })\n}\n\nfunction cursorReturn (item) {\n  term.left(item.left + item.s.length)\n}\n\nfunction paintMovers (line) {\n  const entities = gameState.filter(item => item.up === line).sort((a, b) => a.left > b.left);\n\n  if (entities.length > 0) {\n    entities.forEach(item => {\n      term.right(item.left).write(item.s[item.colour]);\n      cursorReturn(item)\n    })\n    checkBullet(line, entities);\n    if (line === PLAYERLINE) {\n      checkIntersects(line, entities)\n    }\n  }\n}\n\nfunction writeCentre (msg, offset) {\n  term.nl(MIDHEIGHT).write(msg).nl(MIDHEIGHT);\n}\n\nfunction startSequence () {\n  // TODO: Sort out this callback cancer\n  const deferred = Q.defer();\n  for (let i = 0; i < MIDWIDTH + 1; i++) {\n    setTimeout(function () {\n      const str = ' '.repeat(i) + player.s[player.colour];\n      term.write(str);\n      term.left(str.length)\n      if (i === MIDWIDTH) {\n        for (let j = 0; j < PLAYERLINE; j++) {\n          setTimeout(function () {\n            term.left(str.length)\n            term.clearLine().nl().write(str)\n            if (j === PLAYERLINE - 1) {\n              for (let k = 0; k < HEIGHT - PLAYERLINE; k++) {\n                setTimeout(function () { \n                  term.nl();\n                  if (k === HEIGHT - PLAYERLINE - 1) {\n                    deferred.resolve();\n                  }\n                }, 20 * k)\n              }\n            }\n          }, 20 * j)\n        }\n      }\n    }, 10 * i)\n  }\n  return deferred.promise;\n}\n\n\nexport { paintScreen, cursorReturn, writeCentre, startSequence };"]}